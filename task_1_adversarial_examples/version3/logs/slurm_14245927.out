==================================================================
LOCK & RAM Strategy V4: Adaptive Epsilon per Image
==================================================================
Job ID: 14245927
Node: jrc0384
Started: Sun Nov 23 12:19:19 PM CET 2025
GPUs: 2 (parallelized)
Expected duration: ~20-30 minutes
==================================================================

=== GPU Information ===
index, name, memory.total [MiB], driver_version
0, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
1, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
2, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
3, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05

âœ“ Found previous submission (iteration 3): output/submission_ram_v4.npz
âœ“ Found analysis JSON: logs/analysis_api_20251123_120511.json
======================================================================
Lock & Ram Solver V4 - Adaptive Epsilon Initialization
======================================================================
GPUs: 2
GPU 0: NVIDIA A100-SXM4-40GB
  Memory: 42.41 GB
GPU 1: NVIDIA A100-SXM4-40GB
  Memory: 42.41 GB

Loading dataset: ../natural_images.pt
âœ“ Loaded 100 images
  Shape: torch.Size([100, 3, 28, 28])
  Labels: torch.Size([100])
======================================================================

======================================================================
LOCK & RAM STRATEGY V4: FINAL Iteration (Restore Iter2 Epsilon for FAILED)
======================================================================

Step 1: Loading previous submission
  File: output/submission_ram_v4.npz

Loading previous submission: output/submission_ram_v4.npz
âœ“ Loaded 100 adversarial images
  Shape: (100, 3, 28, 28)
  Image IDs: (100,)

Step 2: EPSILON MAPPING - Computing per-image epsilon
  Analysis JSON: logs/analysis_api_20251123_120511.json
  Found iter2 analysis JSON: logs/analysis_api_20251123_110807.json

Computing FINAL epsilons from: logs/analysis_api_20251123_120511.json
Strategy: Restore iter2 epsilon (estimated from L2) for FAILED images, keep current for SUCCESS
  Loading iter2 analysis: logs/analysis_api_20251123_110807.json

Final Epsilon Mapping:
 ID |  Status |  Iter2 L2 |  Est Eps |  Iter3 Eps |  Final Eps |          Action
------------------------------------------------------------------------------------------
  0 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
  1 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
  2 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
  3 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
  4 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
  5 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
  6 |  FAILED |    0.4760 |     23.1 |       30.0 |       30.0 |  RESTORE (30.0)
  7 |  FAILED |    0.4701 |     22.8 |       30.0 |       30.0 |  RESTORE (30.0)
  8 |  FAILED |    0.1624 |      7.9 |        8.0 |        8.0 |   RESTORE (8.0)
  9 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 10 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 11 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 12 |  FAILED |    0.2055 |     10.0 |       10.0 |       10.0 |  RESTORE (10.0)
 13 |  FAILED |    0.0643 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 14 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 15 |  FAILED |    0.2055 |     10.0 |       10.0 |       10.0 |  RESTORE (10.0)
 16 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 17 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 18 |  FAILED |    0.1649 |      8.0 |        8.0 |        8.0 |   RESTORE (8.0)
 19 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 20 |  FAILED |    0.1650 |      8.0 |        8.0 |        8.0 |   RESTORE (8.0)
 21 |  FAILED |    0.0635 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 22 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 23 |  FAILED |    0.4611 |     22.4 |       30.0 |       30.0 |  RESTORE (30.0)
 24 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 25 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 26 |  FAILED |    0.4650 |     22.6 |       30.0 |       30.0 |  RESTORE (30.0)
 27 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 28 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 29 |  FAILED |    0.4858 |     23.6 |       30.0 |       30.0 |  RESTORE (30.0)
 30 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 31 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 32 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 33 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 34 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 35 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 36 |  FAILED |    0.2037 |      9.9 |       10.0 |       10.0 |  RESTORE (10.0)
 37 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 38 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 39 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 40 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 41 |  FAILED |    0.0641 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 42 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 43 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 44 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 45 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 46 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 47 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 48 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 49 | SUCCESS |       N/A |      N/A |        1.0 |        1.1 | INCREASE (1.0â†’1.1)
 50 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 51 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 52 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 53 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 54 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 55 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 56 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 57 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 58 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 59 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 60 |  FAILED |    0.0642 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 61 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 62 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 63 |  FAILED |    0.1630 |      7.9 |        8.0 |        8.0 |   RESTORE (8.0)
 64 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 65 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 66 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 67 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 68 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 69 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 70 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 71 |  FAILED |    0.4730 |     22.9 |       30.0 |       30.0 |  RESTORE (30.0)
 72 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 73 |  FAILED |    0.4752 |     23.0 |       30.0 |       30.0 |  RESTORE (30.0)
 74 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 75 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 76 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 77 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 78 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 79 |  FAILED |    0.0643 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 80 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 81 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 82 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 83 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 84 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 85 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 86 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 87 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 88 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 89 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 90 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 91 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 92 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
 93 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 94 | SUCCESS |       N/A |      N/A |       24.2 |       26.6 | INCREASE (24.2â†’26.6)
 95 |  FAILED |    0.0644 |      3.1 |        3.0 |        3.0 |   RESTORE (3.0)
 96 |  FAILED |    0.1605 |      7.8 |        8.0 |        8.0 |   RESTORE (8.0)
 97 |  FAILED |    0.1650 |      8.0 |        8.0 |        8.0 |   RESTORE (8.0)
 98 |  FAILED |    0.4645 |     22.5 |       30.0 |       30.0 |  RESTORE (30.0)
 99 | SUCCESS |       N/A |      N/A |        7.3 |        8.0 | INCREASE (7.3â†’8.0)
------------------------------------------------------------------------------------------

Summary:
  Restored from iter2 L2 (FAILED): 48 images
  Kept/Increased (SUCCESS): 52 images

Epsilon Distribution:
  Epsilon 1.1: 1 images
  Epsilon 3.0: 31 images
  Epsilon 8.0: 41 images
  Epsilon 8.0: 6 images
  Epsilon 10.0: 3 images
  Epsilon 26.6: 10 images
  Epsilon 30.0: 8 images

âœ“ Saved epsilon mapping to: logs/lock_and_ram_v4_epsilon_mapping.json

âœ“ FINAL ITERATION: Targeting only 48 FAILED images
  Keeping 52 SUCCESS images unchanged

Step 3: RAM - Multi-GPU parallelized attack (FAILED images only)

======================================================================
RAM ATTACK V4: Adaptive Epsilon per Image (ALL Images)
======================================================================

Configuration:
  Target images: 48 (ALL images for L2 optimization)
  GPUs: 2
  Epsilon: Adaptive per image (see mapping above)
  Kappa: 50.0
  PGD steps: 60
  Restarts: 3
  Alpha factor: 2.5
  Momentum: 0.9
  Input Diversity: ENABLED
âœ“ Loaded 44 results from checkpoint
  Remaining to process: 25 images
  GPU 0: 12 images
  GPU 1: 13 images
  âœ“ ResNet50
  âœ“ ResNet50
  âœ“ DenseNet121
âœ“ Loaded 2 ImageNet models + 0 CIFAR models
  Total ensemble size: 2
[GPU 0] Worker started - 12 images
  âœ“ DenseNet121
âœ“ Loaded 2 ImageNet models + 0 CIFAR models
  Total ensemble size: 2
[GPU 1] Worker started - 13 images
[GPU 0] Image ID  22: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +26.94
[GPU 1] Image ID  46: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +25.28

ðŸ’¾ Progress: 2/25 images processed

ðŸ’¾ Progress: 2/25 images processed

ðŸ’¾ Progress: 2/25 images processed
[GPU 0] Image ID  23: âœ— FAILED | Eps: 30.0 | L2: 23.9069 (norm: 0.4930) | Margin: +19.33
[GPU 1] Image ID  73: âœ— FAILED | Eps: 30.0 | L2: 24.0996 (norm: 0.4969) | Margin: +20.67

ðŸ’¾ Progress: 4/25 images processed

ðŸ’¾ Progress: 4/25 images processed
[GPU 0] Image ID  25: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +29.00
[GPU 1] Image ID  77: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +28.23

ðŸ’¾ Progress: 6/25 images processed

ðŸ’¾ Progress: 6/25 images processed

ðŸ’¾ Progress: 6/25 images processed
[GPU 0] Image ID  26: âœ— FAILED | Eps: 30.0 | L2: 23.9411 (norm: 0.4937) | Margin: +20.40
[GPU 1] Image ID  78: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +29.13

ðŸ’¾ Progress: 8/25 images processed

ðŸ’¾ Progress: 8/25 images processed
[GPU 0] Image ID  29: âœ— FAILED | Eps: 30.0 | L2: 24.1939 (norm: 0.4989) | Margin: +19.00
[GPU 1] Image ID  79: âœ— FAILED | Eps: 3.0 | L2: 2.9972 (norm: 0.0618) | Margin: +25.92

ðŸ’¾ Progress: 10/25 images processed

ðŸ’¾ Progress: 10/25 images processed

ðŸ’¾ Progress: 10/25 images processed
[GPU 0] Image ID  30: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +29.13
[GPU 1] Image ID  82: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +30.44

ðŸ’¾ Progress: 12/25 images processed

ðŸ’¾ Progress: 12/25 images processed

ðŸ’¾ Progress: 12/25 images processed
[GPU 0] Image ID  32: âœ— FAILED | Eps: 3.0 | L2: 2.9985 (norm: 0.0618) | Margin: +24.91
[GPU 1] Image ID  83: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +28.29

ðŸ’¾ Progress: 14/25 images processed

ðŸ’¾ Progress: 14/25 images processed
[GPU 0] Image ID  34: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +25.12
[GPU 1] Image ID  88: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +22.77

ðŸ’¾ Progress: 16/25 images processed

ðŸ’¾ Progress: 16/25 images processed

ðŸ’¾ Progress: 16/25 images processed
[GPU 0] Image ID  36: âœ— FAILED | Eps: 10.0 | L2: 9.7682 (norm: 0.2014) | Margin: +20.43
[GPU 1] Image ID  89: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +29.27

ðŸ’¾ Progress: 18/25 images processed

ðŸ’¾ Progress: 18/25 images processed
[GPU 0] Image ID  41: âœ— FAILED | Eps: 3.0 | L2: 2.9942 (norm: 0.0617) | Margin: +28.38
[GPU 1] Image ID  95: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +21.45

ðŸ’¾ Progress: 20/25 images processed

ðŸ’¾ Progress: 20/25 images processed

ðŸ’¾ Progress: 20/25 images processed
[GPU 0] Image ID  44: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +25.93
[GPU 1] Image ID  96: âœ— FAILED | Eps: 8.0 | L2: 7.7561 (norm: 0.1599) | Margin: +25.62

ðŸ’¾ Progress: 22/25 images processed

ðŸ’¾ Progress: 22/25 images processed

ðŸ’¾ Progress: 22/25 images processed
[GPU 0] Image ID  45: âœ— FAILED | Eps: 3.0 | L2: 3.0000 (norm: 0.0619) | Margin: +22.07
[GPU 0] Worker finished
[GPU 1] Image ID  97: âœ— FAILED | Eps: 8.0 | L2: 8.0000 (norm: 0.1650) | Margin: +21.20

ðŸ’¾ Progress: 24/25 images processed

ðŸ’¾ Progress: 24/25 images processed
[GPU 1] Image ID  98: âœ— FAILED | Eps: 30.0 | L2: 24.1028 (norm: 0.4970) | Margin: +20.33
[GPU 1] Worker finished

ðŸ’¾ Progress: 25/25 images processed

âœ“ Completed 25 images in 181.6s
âœ“ Cleared checkpoint (run completed)

Step 4: MERGE - Saving all new attack results

======================================================================
Merging Results: All Images Re-attacked
======================================================================

Merge Summary:
  RAM (new attack): 69 images
  Fallback (previous): 31 images
  Total: 100 images

âœ“ Saved merged submission to: output/submission_ram_v4_final.npz

======================================================================
LOCK & RAM V4 COMPLETE!
======================================================================

Output saved to: output/submission_ram_v4_final.npz

Next steps:
1. Analyze with API: python analyze.py output/submission_ram_v4_final.npz --mode api
2. Review epsilon mapping: cat logs/lock_and_ram_v4_epsilon_mapping.json
3. For next iteration, use the new analysis JSON

==================================================================
Job completed: Sun Nov 23 12:22:29 PM CET 2025
Exit code: 0
==================================================================

âœ“ Lock & Ram V4 strategy completed successfully!

==================================================================
NEXT STEPS FOR ITERATION
==================================================================

1. Analyze new submission with API:
   python analyze.py output/submission_ram_v4.npz --mode api

2. Review epsilon mapping:
   cat logs/lock_and_ram_v4_epsilon_mapping.json

3. For next iteration, update run_lock_and_ram_v4.sh:
   - Set PREVIOUS_SUB to output/submission_ram_v4.npz
   - The script will auto-detect the latest analysis JSON
   - Run: sbatch run_lock_and_ram_v4.sh

4. The system will automatically adjust epsilons based on results

==================================================================
