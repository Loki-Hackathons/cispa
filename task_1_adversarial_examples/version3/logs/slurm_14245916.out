==================================================================
LOCK & RAM Strategy V4: Adaptive Epsilon per Image
==================================================================
Job ID: 14245916
Node: jrc0255
Started: Sun Nov 23 12:10:29 PM CET 2025
GPUs: 2 (parallelized)
Expected duration: ~20-30 minutes
==================================================================

=== GPU Information ===
index, name, memory.total [MiB], driver_version
0, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
1, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
2, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05
3, NVIDIA A100-SXM4-40GB, 40960 MiB, 580.95.05

âœ“ Found previous submission (iteration 3): output/submission_ram_v4.npz
âœ“ Found analysis JSON: logs/analysis_api_20251123_120511.json
======================================================================
Lock & Ram Solver V4 - Adaptive Epsilon Initialization
======================================================================
GPUs: 2
GPU 0: NVIDIA A100-SXM4-40GB
  Memory: 42.41 GB
GPU 1: NVIDIA A100-SXM4-40GB
  Memory: 42.41 GB

Loading dataset: ../natural_images.pt
âœ“ Loaded 100 images
  Shape: torch.Size([100, 3, 28, 28])
  Labels: torch.Size([100])
======================================================================

======================================================================
LOCK & RAM STRATEGY V4: FINAL Iteration (Restore Iter2 Epsilon for FAILED)
======================================================================

Step 1: Loading previous submission
  File: output/submission_ram_v4.npz

Loading previous submission: output/submission_ram_v4.npz
âœ“ Loaded 100 adversarial images
  Shape: (100, 3, 28, 28)
  Image IDs: (100,)

Step 2: EPSILON MAPPING - Computing per-image epsilon
  Analysis JSON: logs/analysis_api_20251123_120511.json

Computing FINAL epsilons from: logs/analysis_api_20251123_120511.json
Strategy: Restore iter2 epsilon (30.0) for FAILED images, keep current for SUCCESS

Final Epsilon Mapping:
 ID |  Status |  Iter3 Eps |  Final Eps |          Action
----------------------------------------------------------------------
  0 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
  1 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
  2 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
  3 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
  4 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
  5 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
  6 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
  7 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
  8 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
  9 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 10 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 11 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 12 |  FAILED |        8.0 |       30.0 |  RESTORE (30.0)
 13 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 14 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 15 |  FAILED |        8.0 |       30.0 |  RESTORE (30.0)
 16 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 17 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 18 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
 19 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 20 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
 21 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 22 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 23 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 24 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 25 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 26 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 27 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 28 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 29 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 30 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 31 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 32 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 33 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 34 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 35 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 36 |  FAILED |        8.0 |       30.0 |  RESTORE (30.0)
 37 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 38 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 39 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 40 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 41 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 42 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 43 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 44 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 45 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 46 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 47 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 48 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 49 | SUCCESS |        0.8 |        0.9 | INCREASE (0.8â†’0.9)
 50 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 51 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 52 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 53 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 54 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 55 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 56 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 57 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 58 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 59 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 60 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 61 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 62 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 63 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
 64 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 65 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 66 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 67 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 68 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 69 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 70 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 71 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 72 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 73 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 74 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 75 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 76 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 77 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 78 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 79 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 80 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 81 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 82 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 83 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 84 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 85 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 86 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 87 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 88 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 89 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 90 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 91 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 92 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
 93 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 94 | SUCCESS |       20.0 |       22.0 | INCREASE (20.0â†’22.0)
 95 |  FAILED |        0.8 |       30.0 |  RESTORE (30.0)
 96 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
 97 |  FAILED |        6.0 |       30.0 |  RESTORE (30.0)
 98 |  FAILED |       20.0 |       30.0 |  RESTORE (30.0)
 99 | SUCCESS |        6.0 |        6.6 | INCREASE (6.0â†’6.6)
----------------------------------------------------------------------

Summary:
  Restored to 30.0 (FAILED): 48 images
  Kept/Increased (SUCCESS): 52 images

âœ“ Saved epsilon mapping to: logs/lock_and_ram_v4_epsilon_mapping.json

âœ“ Targeting ALL 100 images for L2 optimization

Step 3: RAM - Multi-GPU parallelized attack with adaptive epsilon (ALL images)

======================================================================
RAM ATTACK V4: Adaptive Epsilon per Image (ALL Images)
======================================================================

Configuration:
  Target images: 100 (ALL images for L2 optimization)
  GPUs: 2
  Epsilon: Adaptive per image (see mapping above)
  Kappa: 50.0
  PGD steps: 60
  Restarts: 3
  Alpha factor: 2.5
  Momentum: 0.9
  Input Diversity: ENABLED
âœ“ Loaded 98 results from checkpoint
  Remaining to process: 2 images
  GPU 0: 1 images
  GPU 1: 1 images
  âœ“ ResNet50
  âœ“ ResNet50
  âœ“ DenseNet121
âœ“ Loaded 2 ImageNet models + 0 CIFAR models
  Total ensemble size: 2
[GPU 1] Worker started - 1 images
  âœ“ DenseNet121
âœ“ Loaded 2 ImageNet models + 0 CIFAR models
  Total ensemble size: 2
[GPU 0] Worker started - 1 images
[GPU 0] Image ID  49: âœ— FAILED | Eps: 0.9 | L2: 0.8800 (norm: 0.0181) | Margin: +24.23
[GPU 0] Worker finished
[GPU 1] Image ID  99: âœ— FAILED | Eps: 6.6 | L2: 6.5718 (norm: 0.1355) | Margin: +25.39
[GPU 1] Worker finished

ðŸ’¾ Progress: 2/2 images processed

âœ“ Completed 2 images in 20.6s
âœ“ Cleared checkpoint (run completed)

Step 4: MERGE - Saving all new attack results

======================================================================
Merging Results: All Images Re-attacked
======================================================================

Merge Summary:
  RAM (new attack): 100 images
  Fallback (previous): 0 images
  Total: 100 images

âœ“ Saved merged submission to: output/submission_ram_v4_final.npz

======================================================================
LOCK & RAM V4 COMPLETE!
======================================================================

Output saved to: output/submission_ram_v4_final.npz

Next steps:
1. Analyze with API: python analyze.py output/submission_ram_v4_final.npz --mode api
2. Review epsilon mapping: cat logs/lock_and_ram_v4_epsilon_mapping.json
3. For next iteration, use the new analysis JSON

==================================================================
Job completed: Sun Nov 23 12:10:59 PM CET 2025
Exit code: 0
==================================================================

âœ“ Lock & Ram V4 strategy completed successfully!

==================================================================
NEXT STEPS FOR ITERATION
==================================================================

1. Analyze new submission with API:
   python analyze.py output/submission_ram_v4.npz --mode api

2. Review epsilon mapping:
   cat logs/lock_and_ram_v4_epsilon_mapping.json

3. For next iteration, update run_lock_and_ram_v4.sh:
   - Set PREVIOUS_SUB to output/submission_ram_v4.npz
   - The script will auto-detect the latest analysis JSON
   - Run: sbatch run_lock_and_ram_v4.sh

4. The system will automatically adjust epsilons based on results

==================================================================
